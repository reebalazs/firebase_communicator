angular.module("monospaced.elastic",[]).directive("msdElastic",["$timeout","$window",function(a,b){"use strict";return{restrict:"A, C",link:function(c,d,e){function f(){l=i,r=getComputedStyle(i),angular.forEach(z,function(a){q.style[a]=r.getPropertyValue(a)})}function g(){var b,c,d,e;l!==i&&f(),m||(m=!0,q.value=i.value+n,q.style.overflowY=i.style.overflowY,b=""===i.style.height?"auto":parseInt(i.style.height,10),d=parseInt(t?i.offsetWidth:getComputedStyle(i).getPropertyValue("width"),10)-u.width,q.style.width=d+"px",c=q.scrollHeight,c>y?(c=y,e="scroll"):x>c&&(c=x),c+=u.height,i.style.overflowY=e||"hidden",b!==c&&(i.style.height=c+"px"),a(function(){m=!1},1))}function h(){m=!1,g()}var i=d[0],j=d;if("TEXTAREA"===i.nodeName&&b.getComputedStyle){j.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var k=i.value;i.value="",i.value=k;var l,m,n="\\n"===e.msdElastic?"\n":e.msdElastic,o=angular.element(b),p=angular.element('<textarea tabindex="-1" style="position: absolute; top: -999px; right: auto; bottom: auto; left: 0 ;overflow: hidden; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; min-height: 0!important; height: 0!important; padding: 0;word-wrap: break-word; border: 0;"/>').data("elastic",!0),q=p[0],r=getComputedStyle(i),s=r.getPropertyValue("resize"),t="border-box"===r.getPropertyValue("box-sizing")||"border-box"===r.getPropertyValue("-moz-box-sizing")||"border-box"===r.getPropertyValue("-webkit-box-sizing"),u=t?{width:parseInt(r.getPropertyValue("border-top-width"),10)+parseInt(r.getPropertyValue("padding-top"),10)+parseInt(r.getPropertyValue("padding-bottom"),10)+parseInt(r.getPropertyValue("border-bottom-width"),10),height:parseInt(r.getPropertyValue("border-right-width"),10)+parseInt(r.getPropertyValue("padding-right"),10)+parseInt(r.getPropertyValue("padding-left"),10)+parseInt(r.getPropertyValue("border-left-width"),10)}:{width:0,height:0},v=parseInt(r.getPropertyValue("min-height"),10),w=parseInt(r.getPropertyValue("height"),10),x=Math.max(v,w)-u.height,y=parseInt(r.getPropertyValue("max-height"),10),z=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];j.data("elastic")||(y=y&&y>0?y:9e4,q.parentNode!==document.body&&angular.element(document.body).append(q),j.css({resize:"none"===s||"vertical"===s?"none":"horizontal"}).data("elastic",!0),i.oninput="onpropertychange"in i&&"oninput"in i?i.onkeyup=g:g,o.bind("resize",h),a(g),c.$on("$destroy",function(){p.remove(),o.unbind("resize",h)}))}}}}]);